# 3.3 基于特征的周期变化同步机制

## 概述

本节解决的问题是：在自组织分布式网络中，如何让终端与任意邻近验证节点在时间窗、特征参数以及伪名/会话密钥/令牌上保持一致轮换，为3.3.1的"特征→密钥派生"和3.3.2的两种认证模式提供可实现的同步基础。

整体思路是以epoch为时间单位，通过轻量信标同步时间窗和特征配置，在每个epoch内派生一次特征密钥、伪名和会话密钥，并与准入令牌统一轮换。

---

## 1. 时间窗同步与容错机制

### 1.1 基本同步机制

在自组织网络中，每个区域通过路由或上层控制面选举一个**簇首节点**，作为该区域的时间与参数发布者。

簇首周期性广播**同步信标**，内容包括：
- 当前时间窗编号（epoch）
- 轮换周期
- 导频计划标识
- 特征配置编号等

终端和验证节点根据信标，在指定时间窗内完成一次信道特征测量，并分别调用3.3.1中的特征处理与密钥派生算法，获得本轮的稳定特征串S和特征密钥K。

### 1.2 容错策略

考虑到自组织网络中时钟漂移和传播时延较大，本方案不依赖精确对时，而是采用**"多窗容忍 + 短暂双钥"**的容错策略：

#### 多窗容忍

在认证判决时，终端与验证节点默认接受相邻2–3个时间窗内的请求（如epoch-1、epoch、epoch+1），从而吸收百毫秒级的时钟偏差。

#### 短暂双钥

在新旧epoch交替的短时段内，同时保留新旧时间窗对应的会话密钥和伪名：
- 对已获取新票据的设备允许新旧状态并存
- 对旧窗报文则采用更严格的滑动窗口去重规则，降低切换丢包率

### 1.3 优势

通过上述设计，即便不存在全网统一时钟，各节点仍可围绕"近似相同的 epoch"稳定地执行3.3.1和3.3.2的认证流程。

---

## 2. 特征参数同步与子空间轮换机制

### 2.1 问题背景

仅有时间窗一致还不够，3.3.1中的特征密钥派生还依赖一组特征参数：
- 导频时隙
- 采样窗口
- 子载波子集
- 量化门限等

### 2.2 特征参数同步

同步信标在发布epoch的同时，附带当前时间窗的**特征配置**：

#### 导频计划（pilot plan）

指示TDD帧中用于导频对交换的时隙位置和训练图案。

#### 特征采集窗口

指定本轮用于提取CSI/射频特征的时间窗口。

#### 子空间选择种子

由种子导出当前时间窗内采用的子载波子集或特征维度子集。

### 2.3 统一处理流程

终端与验证节点统一按照该配置：
1. 采集和预处理CSI/特征
2. 在相同的子载波子集和门限上运行 3.3.1 中的量化、纠错与模糊提取算法
3. 在双方本地获得一致的S、L、K、Ks

### 2.4 子空间轮换机制

为抵抗攻击者利用历史录制的特征重复构造密钥，本方案在不同epoch周期性轮换子载波子集和量化门限，等价于在时间上不断切换特征子空间。

### 2.5 一致性校验

3.3.1会输出一个简短的一致性摘要digest：
- 终端在AuthReq中携带该摘要
- 验证端重构特征后先检查digest是否一致
- 再进行Tag校验

这样可以避免"特征参数没对齐却强行认证"的情况。

---

## 3. 伪名、会话密钥与令牌的统一轮换

### 3.1 轮换机制

在时间窗和特征参数同步的基础上，本机制进一步将伪名、会话密钥和准入令牌统一绑定到当前epoch，实现**"按窗授权、过期即换"**的接入控制。

#### epoch内的密钥生成

在每个epoch内，终端调用3.3.1获得：
- 特征密钥K
- 会话密钥 Ks
- 基于K、epoch 及哈希链状态等生成本轮伪名DevPseudo

这样，同一物理设备在不同时间窗使用不同的链路层标识和密钥，降低长期跟踪风险。

#### 强认证模式中的令牌签发

在强认证模式（3.3.2 模式二）中：
1. 验证节点利用本地重构的K′ 对首包Tag进行校验
2. 通过后为当前epoch签发准入令牌MAT
3. MAT中显式记录绑定的epoch、区域标识和有效期等信息
4. 其默认有效时间与epoch一致

#### 轮换触发

时间窗结束或MAT被吊销时：
- 旧伪名、旧Ks和旧MAT自动失效
- 终端必须在新的epoch 内重新发起3.3.2的认证流程，才能继续访问网络

### 3.2 快速认证模式的处理

对于快速认证模式（3.3.2模式一）：
- 其轻量票据的有效期远短于epoch
- 仅用于秒级放行和前置筛查
- 真正支撑长期数据面的仍是与epoch 绑定的Ks与MAT

从而保证整体安全边界由"特征密钥 + 周期轮换"共同确定。

---

## 4. 失步与重同步处理策略

### 4.1 问题场景

考虑到自组织网络可能出现：
- 簇首暂时不可达
- 网络分区
- 节点重启等情况

### 4.2 轻量失步处理策略

本机制设计了轻量的失步处理和重同步策略，以在安全性和可用性之间取得平衡。

#### 本地时钟平滑推进

当终端或某个验证节点在一段时间内未收到新的同步信标时：
- 可根据上一条信标的epoch和轮换周期，通过本地时钟平滑推进epoch
- 继续按照上一轮导频计划和特征配置执行3.3.1与3.3.2
- 保证系统在短时间内不中断服务

#### epoch偏差检测

在本地推进期间：
- 节点仍要求认证报文中携带的epoch与本地窗口相符
- 若偏差超过预设范围，则直接拒绝并返回"需要重同步"的标志
- 引导终端等待新的信标

#### 重同步流程

一旦重新接收到来自可信簇首的有效信标：
1. 终端和验证节点立即对齐到网络主时间窗
2. 强制触发一次新的导频测量和首包认证过程
3. 刷新伪名、会话密钥和MAT
4. 旧令牌进入回收或吊销流程

### 4.3 设计优势

通过"信标驱动 + 多窗容忍 + 本地暂存 + 重同步"的组合，本机制在不依赖精细时钟和集中控制的前提下：

- 为基于特征的加密与认证提供了一个简单可实现、参数可调、错误可恢复的周期同步框架
- 使3.3.1与3.3.2能在自组织分布式环境中长期稳定运行

---

## 总结

基于特征的周期变化同步机制通过以下三个核心机制，实现了自组织分布式网络中的安全接入控制：

1. **时间窗同步与容错机制**：通过簇首信标广播和多窗容忍策略，吸收时钟偏差，保证认证流程的稳定性

2. **特征参数同步与子空间轮换**：通过统一的特征配置和周期性子空间轮换，确保双方密钥派生一致性，同时抵御历史特征重放攻击

3. **伪名、会话密钥与令牌的统一轮换**：将身份标识、加密密钥和准入令牌与时间窗绑定，实现"按窗授权、过期即换"，降低长期跟踪风险

4. **失步与重同步处理**：通过本地平滑推进和强制重同步策略，在可用性和安全性之间取得平衡

这些机制共同构成了一个轻量级、可扩展、容错性强的同步框架，为3.3.1的特征加密算法和3.3.2的两种认证模式提供了可靠的运行基础。
